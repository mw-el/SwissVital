<!-- 
  Sport-Fragebogen — ein spezialisierter Fragebogen für Sportler
  Datenstrom: form-sportler-survey
  
  Dieser Shortcode implementiert das dreistufige Formular für Sportler, das:
  1. Persönliche Daten erfasst
  2. Sport-spezifische Informationen sammelt
  3. Kontaktdaten für die Rücksprache erfasst
  
  Das Formular nutzt das zentrale Spam-Schutz-, Dropdown- und Formularverarbeitungssystem.

  ARCHITEKTUR UND FUNKTIONSWEISE:
  ------------------------------
  1. FORMULAR-STRUKTUR:
     - Das Formular ist in drei "Schritte" unterteilt, implementiert als <section>-Elemente.
     - Die Navigation zwischen den Schritten erfolgt via JavaScript.
     - Jeder Schritt hat seine eigenen Validierungsregeln.

  2. DATENFLUSS UND VERARBEITUNG:
     - Daten werden via AJAX an /.netlify/functions/formSubmissionProcessing gesendet.
     - Server validiert Eingaben und überprüft auf Spam-Merkmale.
     - Bei Erfolg: E-Mail-Versand via sendConfirmartonBilingualFragebogen.js.
     - Bei Erfolg (Client): Formular wird ausgeblendet, Erfolgsmeldung wird angezeigt.

  3. ZENTRALE KOMPONENTEN:
     - spam-protection-fields.html: Liefert versteckte Felder für Spam-Schutz.
     - form-assets.html: Lädt JS-Ressourcen und initialisiert Formularverarbeitung.
     - form-spam-protection-utils.js: Enthält Funktionen für Spam-Schutz und AJAX-Übermittlung.
     - form-dropdown-utils.js: Enthält Funktionen zur Initialisierung von Custom-Dropdowns.
     - formSubmissionProcessing.js: Server-seitige Validierung und Weiterleitung.
     - sendConfirmartonBilingualFragebogen.js: Generiert und sendet E-Mails.
     - email-routing.json: Konfiguriert E-Mail-Routing basierend auf Formulartyp und Standort.

  4. SPEZIELLES FÜR DIESES FORMULAR:
     - Custom Dropdowns: Gesteuert durch form-dropdown-utils.js
     - Telefonnummern-Formatierung: Spezielle Validierung für CH-Nummern.
     - Mehrfachauswahl: Bestimmte Felder erlauben mehrere Antworten.
-->
<form id="form-sportler-survey" class="sv-multistep-form"
      name="fragebogen-sportler" method="POST"
      data-netlify="true" netlify-honeypot="bot-field">

  <!-- 
    Hidden Fields:
    - language: Sprachversion für die E-Mail-Verarbeitung
    - form-name: Netlify-Identifier für die Formularverarbeitung
    - form_type: Formulartyp für die zentralisierte Verarbeitung und E-Mail-Routing
                Dieser Wert wird in formSubmissionProcessing.js verwendet, um das 
                richtige E-Mail-Template und die Empfängerliste zu bestimmen.
  -->
  <input type="hidden" name="language" value="de">
  <input type="hidden" name="form-name" value="fragebogen-sportler">
  <input type="hidden" name="form_type" value="sportler-survey">
  
  <!-- 
    Spam-Schutz-Felder:
    Diese werden über das spam-protection-fields.html Partial eingebunden, welches enthält:
    - sv_id: Eine client-seitig generierte eindeutige ID, die Bot-Aktivität erkennen hilft
    - form_start_time: Zeitstempel der Formularerstellung für zeitbasierte Spam-Erkennung
    - website: Ein verstecktes Feld, das nur von Bots ausgefüllt wird (Honeypot)
    
    Die Werte werden vom form-spam-protection-utils.js Script automatisch gesetzt und
    später von formSubmissionProcessing.js validiert.
  -->
  {{ partial "spam-protection-fields.html" (dict "FORM_ID" "form-sportler-survey") }}
  
  <!-- Original honeypot field für Netlify - zweite Schutzebene -->
  <p class="d-none"><label>Bitte nicht ausfüllen: <input name="bot-field"></label></p>

  <!-- ---------- Schritt 1: Persönliche Daten ---------- -->
  <section id="form-sportler-survey-step-1" class="sv-form-step active" data-step="1">
    <h3 class="sv-step-title mb-4">Schritt 1 von 3: Persönliche Angaben</h3>

    <div class="form-floating sv-form-floating mb-3">
      <input class="form-control" id="form-sportler-survey-vorname"
             name="vorname" placeholder="Vorname *" required>
      <label for="form-sportler-survey-vorname">Vorname *</label>
    </div>

    <div class="form-floating sv-form-floating mb-3">
      <input class="form-control" id="form-sportler-survey-nachname"
             name="nachname" placeholder="Nachname *" required>
      <label for="form-sportler-survey-nachname">Nachname *</label>
    </div>

    <div class="form-floating sv-form-floating mb-3">
      <input class="form-control" id="form-sportler-survey-email" type="email"
             name="email" placeholder="name@example.com" required>
      <label for="form-sportler-survey-email">E-Mail-Adresse *</label>
    </div>

    <div class="form-floating sv-form-floating mb-3">
      <input class="form-control" id="form-sportler-survey-gebjahr"
             name="geburtsjahr" placeholder="Geburtsjahr *" 
             required type="number" min="1900" max="2050">
      <label for="form-sportler-survey-gebjahr">Geburtsjahr *</label>
    </div>


    <p class="sv-tooltip-info mb-2">
      Für diagnostische Zwecke – z.&nbsp;B. Laboruntersuchungen – ist das biologische
      Geschlecht wichtig, unabhängig von Ihrer geschlechtlichen Identität.
    </p>
    
    <!-- 
      Custom Dropdown für biologisches Geschlecht (Single-Choice)
      Diese eigene Dropdown-Implementierung verwendet Checkboxen im Hintergrund,
      zeigt aber nur eine Auswahl an (isSingleChoice=true in der JavaScript-Initialisierung).
      Die Dropdown-Funktionalität wird durch form-dropdown-utils.js gesteuert.
    -->
    <div class="form-floating sv-form-floating mb-3">
      <div class="form-control form-select" id="form-sportler-survey-geschlecht-display" 
           style="height: auto; min-height: 58px; cursor: pointer;">
        Bitte wählen
      </div>
      <label for="form-sportler-survey-geschlecht-display">Biologisches Geschlecht *</label>
      <div class="dropdown-menu p-3" id="form-sportler-survey-geschlecht-dropdown" style="display: none; width: 100%;">
        <div class="form-check">
          <input class="form-check-input" type="checkbox" value="männlich" id="geschlecht1" name="geschlecht">
          <label class="form-check-label" for="geschlecht1">männlich</label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="checkbox" value="weiblich" id="geschlecht2" name="geschlecht">
          <label class="form-check-label" for="geschlecht2">weiblich</label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="checkbox" value="möchte ich nicht angeben" id="geschlecht3" name="geschlecht">
          <label class="form-check-label" for="geschlecht3">möchte ich nicht angeben</label>
        </div>
      </div>
    </div>

    <div class="sv-form-check-container mb-3">
      <input class="form-check-input" id="form-sportler-survey-dsp1"
             type="checkbox" name="datenschutz1" required>
      <label class="form-check-label" for="form-sportler-survey-dsp1">
        Ich stimme der Datenverarbeitung zu.
      </label>
    </div>

    <div class="d-grid sv-button-container">
      <button type="button" class="btn btn-primary sv-btn-xl" data-next>Weiter</button>
    </div>
  </section>

  <!-- ---------- Schritt 2: Sportliche Aktivität ---------- -->
  <section id="form-sportler-survey-step-2" class="sv-form-step" data-step="2">
    <h3 class="sv-step-title mb-4">Schritt 2 von 3: Sportliche Aktivität</h3>

    <!-- Custom Dropdown für Sport-Häufigkeit (Single-Choice) -->
    <div class="form-floating sv-form-floating mb-3">
      <div class="form-control form-select" id="form-sportler-survey-sportfreq-display" 
           style="height: auto; min-height: 58px; cursor: pointer;">
        Bitte wählen
      </div>
      <label for="form-sportler-survey-sportfreq-display">1. Wie häufig treiben Sie Sport?</label>
      <div class="dropdown-menu p-3" id="form-sportler-survey-sportfreq-dropdown" style="display: none; width: 100%;">
        <div class="form-check">
          <input class="form-check-input" type="checkbox" value="Täglich" id="freq1" name="sport_frequency">
          <label class="form-check-label" for="freq1">Täglich</label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="checkbox" value="Mehrmals pro Woche" id="freq2" name="sport_frequency">
          <label class="form-check-label" for="freq2">Mehrmals pro Woche</label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="checkbox" value="Einmal pro Woche" id="freq3" name="sport_frequency">
          <label class="form-check-label" for="freq3">Einmal pro Woche</label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="checkbox" value="Gelegentlich" id="freq4" name="sport_frequency">
          <label class="form-check-label" for="freq4">Gelegentlich</label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="checkbox" value="Selten bis nie" id="freq5" name="sport_frequency">
          <label class="form-check-label" for="freq5">Selten bis nie</label>
        </div>
      </div>
    </div>

    <!-- 
      Custom Dropdown für Sportarten (Multiple-Choice)
      Bei dieser Variante können mehrere Optionen ausgewählt werden (isSingleChoice=false).
      Das name-Attribut endet mit [], was im Backend als Array interpretiert wird.
    -->
    <div class="form-floating sv-form-floating mb-3">
      <div class="form-control form-select" id="form-sportler-survey-sportarten-display" 
           style="height: auto; min-height: 58px; cursor: pointer;">
        Bitte wählen
      </div>
      <label for="form-sportler-survey-sportarten-display">
        2. Welche Sportart betreiben Sie hauptsächlich? (Mehrfachauswahl möglich)
      </label>
      <div class="dropdown-menu p-3" id="form-sportler-survey-sportarten-dropdown" style="display: none; width: 100%;">
        <div class="form-check">
          <input class="form-check-input" type="checkbox" value="Kraftsport" id="sportart1" name="sportarten[]">
          <label class="form-check-label" for="sportart1">Kraftsport</label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="checkbox" value="Ausdauersport" id="sportart2" name="sportarten[]">
          <label class="form-check-label" for="sportart2">Ausdauersport</label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="checkbox" value="Teamsport" id="sportart3" name="sportarten[]">
          <label class="form-check-label" for="sportart3">Teamsport</label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="checkbox" value="Extremsport" id="sportart4" name="sportarten[]">
          <label class="form-check-label" for="sportart4">Extremsport</label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="checkbox" value="Verschiedene" id="sportart5" name="sportarten[]">
          <label class="form-check-label" for="sportart5">Verschiedene</label>
        </div>
      </div>
    </div>

    <!-- Custom Dropdown für kürzliche Verletzungen (Single-Choice) -->
    <div class="form-floating sv-form-floating mb-3">
      <div class="form-control form-select" id="form-sportler-survey-recentinj-display" 
           style="height: auto; min-height: 58px; cursor: pointer;">
        Bitte wählen
      </div>
      <label for="form-sportler-survey-recentinj-display">
        3. Haben Sie in den letzten 12 Monaten Verletzungen erlitten?
      </label>
      <div class="dropdown-menu p-3" id="form-sportler-survey-recentinj-dropdown" style="display: none; width: 100%;">
        <div class="form-check">
          <input class="form-check-input" type="checkbox" value="Ja, schwere Verletzung (z. B. Bänderriss)" id="recentinj1" name="recent_injuries">
          <label class="form-check-label" for="recentinj1">Ja, schwere Verletzung (z. B. Bänderriss)</label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="checkbox" value="Ja, mittelschwere Verletzung (z. B. Zerrung)" id="recentinj2" name="recent_injuries">
          <label class="form-check-label" for="recentinj2">Ja, mittelschwere Verletzung (z. B. Zerrung)</label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="checkbox" value="Ja, leichte Beschwerden (z. B. Muskelkater)" id="recentinj3" name="recent_injuries">
          <label class="form-check-label" for="recentinj3">Ja, leichte Beschwerden (z. B. Muskelkater)</label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="checkbox" value="Nein" id="recentinj4" name="recent_injuries">
          <label class="form-check-label" for="recentinj4">Nein</label>
        </div>
      </div>
    </div>

    <!-- Custom Dropdown für frühere Verletzungen (Multiple-Choice) -->
    <div class="form-floating sv-form-floating mb-3">
      <div class="form-control form-select" id="form-sportler-survey-previnj-display" 
           style="height: auto; min-height: 58px; cursor: pointer;">
        Bitte wählen
      </div>
      <label for="form-sportler-survey-previnj-display">
        4. Frühere Verletzungen oder Überlastungsschäden (Mehrfachauswahl möglich)
      </label>
      <div class="dropdown-menu p-3" id="form-sportler-survey-previnj-dropdown" style="display: none; width: 100%;">
        <div class="form-check">
          <input class="form-check-input" type="checkbox" value="Knochenbrüche / Gelenkverletzungen" id="previnj1" name="fruehere_verletzungen[]">
          <label class="form-check-label" for="previnj1">Knochenbrüche / Gelenkverletzungen</label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="checkbox" value="Muskel- / Sehnenverletzungen" id="previnj2" name="fruehere_verletzungen[]">
          <label class="form-check-label" for="previnj2">Muskel- / Sehnenverletzungen</label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="checkbox" value="Chronische Überlastungsbeschwerden" id="previnj3" name="fruehere_verletzungen[]">
          <label class="form-check-label" for="previnj3">Chronische Überlastungsbeschwerden</label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="checkbox" value="Andere sportbedingte Probleme" id="previnj4" name="fruehere_verletzungen[]">
          <label class="form-check-label" for="previnj4">Andere sportbedingte Probleme</label>
        </div>
      </div>
    </div>

    <!-- Custom Dropdown für Körperregionen (Multiple-Choice) -->
    <div class="form-floating sv-form-floating mb-3">
      <div class="form-control form-select" id="form-sportler-survey-region-display" 
           style="height: auto; min-height: 58px; cursor: pointer;">
        Bitte wählen
      </div>
      <label for="form-sportler-survey-region-display">
        5. Welche Körperregion belasten Sie am meisten? (Mehrfachauswahl möglich)
      </label>
      <div class="dropdown-menu p-3" id="form-sportler-survey-region-dropdown" style="display: none; width: 100%;">
        <div class="form-check">
          <input class="form-check-input" type="checkbox" value="Rücken" id="region1" name="koerperregionen[]">
          <label class="form-check-label" for="region1">Rücken</label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="checkbox" value="Knie / Gelenke" id="region2" name="koerperregionen[]">
          <label class="form-check-label" for="region2">Knie / Gelenke</label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="checkbox" value="Schultern / Arme" id="region3" name="koerperregionen[]">
          <label class="form-check-label" for="region3">Schultern / Arme</label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="checkbox" value="Muskulatur allgemein" id="region4" name="koerperregionen[]">
          <label class="form-check-label" for="region4">Muskulatur allgemein</label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="checkbox" value="Ganzer Körper" id="region5" name="koerperregionen[]">
          <label class="form-check-label" for="region5">Ganzer Körper</label>
        </div>
      </div>
    </div>

    <!-- Custom Dropdown für Schmerzen nach Sport (Single-Choice) -->
    <div class="form-floating sv-form-floating mb-3">
      <div class="form-control form-select" id="form-sportler-survey-pain-display" 
           style="height: auto; min-height: 58px; cursor: pointer;">
        Bitte wählen
      </div>
      <label for="form-sportler-survey-pain-display">
        6. Haben Sie anhaltende Schmerzen nach dem Sport?
      </label>
      <div class="dropdown-menu p-3" id="form-sportler-survey-pain-dropdown" style="display: none; width: 100%;">
        <div class="form-check">
          <input class="form-check-input" type="checkbox" value="Ja, regelmässig" id="pain1" name="pain_after_sport">
          <label class="form-check-label" for="pain1">Ja, regelmässig</label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="checkbox" value="Gelegentlich" id="pain2" name="pain_after_sport">
          <label class="form-check-label" for="pain2">Gelegentlich</label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="checkbox" value="Nur nach intensiven Einheiten" id="pain3" name="pain_after_sport">
          <label class="form-check-label" for="pain3">Nur nach intensiven Einheiten</label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="checkbox" value="Selten bis nie" id="pain4" name="pain_after_sport">
          <label class="form-check-label" for="pain4">Selten bis nie</label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="checkbox" value="Keine Schmerzen" id="pain5" name="pain_after_sport">
          <label class="form-check-label" for="pain5">Keine Schmerzen</label>
        </div>
      </div>
    </div>

    <div class="form-floating sv-form-floating mb-4">
      <textarea class="form-control" id="form-sportler-survey-freetext"
                name="freitext" style="height:150px"></textarea>
      <label for="form-sportler-survey-freetext">
        Freitext – Was möchten Sie uns sonst noch mitteilen?
      </label>
    </div>

    <div class="d-flex justify-content-between sv-button-container">
      <button type="button" class="btn btn-secondary sv-btn-xl" data-prev>Zurück</button>
      <button type="button" class="btn btn-primary sv-btn-xl" data-next>Weiter</button>
    </div>
  </section>

  <!-- ---------- Schritt 3: Kontaktaufnahme ---------- -->
  <section id="form-sportler-survey-step-3" class="sv-form-step" data-step="3">
    <h3 class="sv-step-title mb-4">Schritt 3 von 3: Kontaktaufnahme</h3>

    <!-- 
      Telefon-Feld mit spezieller Validierung und Formatierung
      Das Blur-Event aktiviert eine Funktion, die Schweizer Nummern validiert
      und in das Format "XXX XXX XX XX" umformatiert.
    -->
    <div class="form-floating sv-form-floating mb-3">
      <input class="form-control" id="form-sportler-survey-tel"
             name="telefon" type="tel" placeholder="Ihre Telefonnummer" required>
      <label for="form-sportler-survey-tel">Ihre Telefonnummer</label>
    </div>
    <p class="sv-tooltip-info mb-3">
      Bitte Mobilnummer mit Landesvorwahl angeben, z.&nbsp;B. +41 79 123 45 67
    </p>

    <!-- Custom Dropdown für Rückrufzeiten (Multiple-Choice) -->
    <div class="form-floating sv-form-floating mb-3">
      <div class="form-control form-select" id="form-sportler-survey-calltime-display" 
           style="height: auto; min-height: 58px; cursor: pointer;">
        Bitte wählen
      </div>
      <label for="form-sportler-survey-calltime-display">
        Bevorzugte Rückrufzeiten (Mehrfachauswahl möglich)
      </label>
      <div class="dropdown-menu p-3" id="form-sportler-survey-calltime-dropdown" style="display: none; width: 100%;">
        <div class="form-check">
          <input class="form-check-input" type="checkbox" value="Vormittags (08:00–12:00 Uhr)" id="calltime1" name="rueckruf_zeiten[]">
          <label class="form-check-label" for="calltime1">Vormittags (08:00–12:00 Uhr)</label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="checkbox" value="Mittags (12:00–14:00 Uhr)" id="calltime2" name="rueckruf_zeiten[]">
          <label class="form-check-label" for="calltime2">Mittags (12:00–14:00 Uhr)</label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="checkbox" value="Nachmittags (14:00–18:00 Uhr)" id="calltime3" name="rueckruf_zeiten[]">
          <label class="form-check-label" for="calltime3">Nachmittags (14:00–18:00 Uhr)</label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="checkbox" value="Abends (18:00–20:00 Uhr)" id="calltime4" name="rueckruf_zeiten[]">
          <label class="form-check-label" for="calltime4">Abends (18:00–20:00 Uhr)</label>
        </div>
      </div>
    </div>

    <div class="form-floating sv-form-floating mb-3">
      <textarea class="form-control" id="form-sportler-survey-extra"
                name="zusatzinformationen" style="height:100px"></textarea>
      <label for="form-sportler-survey-extra">
        Zusätzliche Informationen zur Erreichbarkeit (optional)
      </label>
    </div>

    <div class="sv-form-check-container mb-3">
      <input class="form-check-input" id="form-sportler-survey-privacy"
             type="checkbox" name="datenschutz" required>
      <label class="form-check-label" for="form-sportler-survey-privacy">
        Ich stimme der <a href="/privacy">Datenschutzerklärung</a> zu.
      </label>
    </div>

    <div class="d-flex justify-content-between sv-button-container">
      <button type="button" class="btn btn-secondary sv-btn-xl" data-prev>Zurück</button>
      <button type="submit" class="btn btn-primary sv-btn-xl">Absenden</button>
    </div>
  </section>
</form>

<!-- 
  Erfolgsnachricht:
  Wird nach erfolgreicher Formularübermittlung angezeigt.
  
  Bei erfolgreicher Übermittlung:
  1. Das Formular wird per JavaScript ausgeblendet (form.classList.add('d-none'))
  2. Diese Erfolgsmeldung wird eingeblendet (success.classList.remove('d-none'))
  3. Die Zusammenfassung wird mit übermittelten Daten befüllt (#form-sportler-survey-summary)
  4. Die E-Mail-Bestätigung wird aktualisiert (#form-sportler-survey-emailConfirm)
  
  Dies geschieht automatisch durch die handleFormSubmit-Funktion in form-spam-protection-utils.js
-->
<div id="form-sportler-survey-success" class="card shadow-sm p-4 mt-4 text-center d-none sv-success-message">
  <h3 class="text-success mb-3"><i class="material-icons">check_circle</i> Vielen Dank für Ihre Anmeldung!</h3>
  <p class="mb-3"><strong>Sie haben uns das Folgende mitgeteilt:</strong></p>
  <div class="text-start" id="form-sportler-survey-summary"></div>
  <hr>
  <p class="lead mt-3" id="form-sportler-survey-emailConfirm"></p>
</div>

<!-- 
  Einbindung der zentralisierten Form-Assets:
  
  1. Was es ist: 
     Ein Hugo-Partial, das die nötigen JavaScript-Ressourcen lädt und initialisiert.
  
  2. Welche Datei aufgerufen wird: 
     layouts/partials/form-assets.html
  
  3. Was diese Datei tut:
     - Lädt form-spam-protection-utils.js und form-dropdown-utils.js
     - Initialisiert drei Hauptfunktionen, wenn das DOM geladen ist:
       * initSpamProtection('form-sportler-survey') - Setzt unique ID und Zeitstempel
       * handleFormSubmit('form-sportler-survey', {...}) - Registriert Submit-Handler
       * Initialisiert alle im CustomDropdowns übergebenen Dropdowns
  
  4. Parameter:
     - FormID: Der Selektor des Formulars ('form-sportler-survey')
     - FieldLabels: Dictionary mit Übersetzungen für die Zusammenfassung
     - CustomDropdowns: Liste von Dropdown-Definitionen für automatische Initialisierung
-->
{{ partial "form-assets.html" (dict
  "FormID" "form-sportler-survey"
  "FieldLabels" (dict
    "vorname" "Vorname"
    "nachname" "Nachname"
    "email" "E-Mail"
    "geburtsjahr" "Geburtsjahr"
    "telefon" "Telefon"
    "geschlecht" "Biologisches Geschlecht"
    "sport_frequency" "Sporthäufigkeit"
    "recent_injuries" "Verletzungen in den letzten 12 Monaten"
    "pain_after_sport" "Schmerzen nach dem Sport"
    "sportarten" "Sportarten"
    "fruehere_verletzungen" "Frühere Verletzungen"
    "koerperregionen" "Körperregionen"
    "rueckruf_zeiten" "Rückrufzeiten"
    "freitext" "Freitext"
    "zusatzinformationen" "Zusatzinformationen"
  )
  "CustomDropdowns" (slice
    (dict 
      "displayId" "form-sportler-survey-geschlecht-display" 
      "dropdownId" "form-sportler-survey-geschlecht-dropdown" 
      "checkboxName" "geschlecht" 
      "isSingleChoice" true
    )
    (dict 
      "displayId" "form-sportler-survey-sportfreq-display" 
      "dropdownId" "form-sportler-survey-sportfreq-dropdown" 
      "checkboxName" "sport_frequency" 
      "isSingleChoice" true
    )
    (dict 
      "displayId" "form-sportler-survey-recentinj-display" 
      "dropdownId" "form-sportler-survey-recentinj-dropdown" 
      "checkboxName" "recent_injuries" 
      "isSingleChoice" true
    )
    (dict 
      "displayId" "form-sportler-survey-pain-display" 
      "dropdownId" "form-sportler-survey-pain-dropdown" 
      "checkboxName" "pain_after_sport" 
      "isSingleChoice" true
    )
    (dict 
      "displayId" "form-sportler-survey-sportarten-display" 
      "dropdownId" "form-sportler-survey-sportarten-dropdown" 
      "checkboxName" "sportarten[]" 
      "isSingleChoice" false
    )
    (dict 
      "displayId" "form-sportler-survey-previnj-display" 
      "dropdownId" "form-sportler-survey-previnj-dropdown" 
      "checkboxName" "fruehere_verletzungen[]" 
      "isSingleChoice" false
    )
    (dict 
      "displayId" "form-sportler-survey-region-display" 
      "dropdownId" "form-sportler-survey-region-dropdown" 
      "checkboxName" "koerperregionen[]" 
      "isSingleChoice" false
    )
    (dict 
      "displayId" "form-sportler-survey-calltime-display" 
      "dropdownId" "form-sportler-survey-calltime-dropdown" 
      "checkboxName" "rueckruf_zeiten[]" 
      "isSingleChoice" false
    )
  )
) }}

<!-- 
  Formularspezifisches JavaScript:
  
  FUNKTIONALITÄT:
  1. Schritt-Navigation:
     - Bei Klick auf [data-next] und [data-prev] werden die Formularschritte gewechselt
     - Die show(n)-Funktion macht den n-ten Schritt sichtbar und scrollt zur richtigen Position
  
  2. Telefonnummer-Formatierung:
     - Bei blur-Event wird die Telefonnummer validiert und formatiert
     - Prüfung auf 10 Ziffern mit führender 0
     - Formatierung in Gruppen: XXX XXX XX XX
  
  HINWEIS:
  - Die Custom-Dropdown-Funktionalität wird jetzt durch form-dropdown-utils.js zentral verwaltet
  - Die Initialisierung erfolgt durch form-assets.html mit den übergebenen CustomDropdowns
  - Die eigentliche Formularabsendung wird durch handleFormSubmit() aus form-spam-protection-utils.js übernommen
-->
<script>
document.addEventListener('DOMContentLoaded', () => {
  const form = document.getElementById('form-sportler-survey');
  const steps = form.querySelectorAll('.sv-form-step');
  
  // Navigation zwischen Formularschritten
  const show = n => { 
    steps.forEach(s => s.classList.remove('active'));
    steps[n-1].classList.add('active');
    window.scroll({top: form.offsetTop-20, behavior:'smooth'}); 
  };

  // Event-Handler für Weiter-Buttons
  form.querySelectorAll('[data-next]').forEach(btn => {
    btn.addEventListener('click', () => {
      const currentStep = btn.closest('.sv-form-step');
      const stepNumber = +currentStep.dataset.step;
      show(stepNumber + 1);
    });
  });

  // Event-Handler für Zurück-Buttons
  form.querySelectorAll('[data-prev]').forEach(btn => {
    btn.addEventListener('click', () => {
      const currentStep = btn.closest('.sv-form-step');
      const stepNumber = +currentStep.dataset.step;
      show(stepNumber - 1);
    });
  });

  // Telefonnummer-Formatierung
  const tel = document.getElementById('form-sportler-survey-tel');
  const fmt = n => n.replace(/\D/g,'').replace(/(\d{3})(\d{3})(\d{2})(\d{2})/,'$1 $2 $3 $4');
  
  tel.addEventListener('blur', () => {
    const d = tel.value.replace(/\D/g,'');
    if(d.length !== 10 || d[0] !== '0') { 
      alert('Bitte geben Sie eine gültige Telefonnummer mit 10 Ziffern ein.'); 
      tel.value = ''; 
      tel.focus();
    } else {
      tel.value = fmt(d);
    }
  });
  
  // Hinweis: Die Custom-Dropdown-Initialisierung erfolgt jetzt zentral über form-assets.html
  // und die dort übergebenen CustomDropdowns werden durch form-dropdown-utils.js verarbeitet
});
</script>

<!-- 
  GESAMTDATENFLUSS ZUSAMMENFASSUNG:
  
  1. CLIENT-SEITE VORBEREITUNG
     - Nutzer öffnet die Seite mit dem Formular
     - form-assets.html lädt form-spam-protection-utils.js und form-dropdown-utils.js
     - initSpamProtection() generiert sv_id und form_start_time
     - handleFormSubmit() registriert einen Submit-Handler für das Formular
     - Custom-Dropdowns werden durch initializeDropdown() aus form-dropdown-utils.js initialisiert
  
  2. NUTZER-INTERAKTION
     - Nutzer füllt das Formular in den drei Schritten aus
     - Custom Dropdowns und Telefon-Formatierung unterstützen die Eingabe
     - Beim Klick auf "Absenden" wird das submit-Event ausgelöst
  
  3. FORMULARVERARBEITUNG
     - handleFormSubmit() in form-spam-protection-utils.js fängt das submit-Event ab
     - Alle Formulardaten werden gesammelt und als JSON strukturiert
     - Spam-Schutz-Informationen (sv_id, form_start_time) werden hinzugefügt
     - AJAX-Anfrage an /.netlify/functions/formSubmissionProcessing wird gesendet
  
  4. SERVER-SIDE VERARBEITUNG
     - formSubmissionProcessing.js validiert die Daten und prüft auf Spam
     - E-Mail-Routing wird anhand der Formulartyp-Konfiguration bestimmt
     - sendConfirmartonBilingualFragebogen.js generiert und sendet E-Mails
     - Erfolgsmeldung oder Fehlermeldung wird zurückgegeben
  
  5. ERFOLGS-DARSTELLUNG
     - Bei Erfolg blendet handleFormSubmit() das Formular aus
     - Erfolgsmeldung wird eingeblendet
     - Die Zusammenfassung wird mit den übermittelten Daten gefüllt
     - E-Mail-Bestätigung wird angezeigt
-->
 übergebenen Dropdowns